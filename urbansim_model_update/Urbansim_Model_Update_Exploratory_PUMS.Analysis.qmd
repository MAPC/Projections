---
title: "Urbansim Model Update Exploratory Analysis"
format: html
editor: visual
---
# 0.0 Environment and Script Set-up
# 0.1 Load Libraries and Functions
```{r}
# Libraries used in Urbansim/Projections workflow
source(here(paste("/urbansim_model_update/projections_libraries.R")))
# Functions created for the Urbansim/Projections workflow
source(here(paste("/urbansim_model_update/projections_functions.R")))
```
# 0.2 Set Environment Variables for this Script
```{r}
# Set random seed
set.seed(351)

# Remove scientific notation
options(scipen = 999)

# Set the PUMS API call variables for this analysis. Used in the 
# Variables from the PUMS data to query (data dictionary is here)
pums.vars <- c(
               # General PUMS variables
               'PUMA', #PUMA designation
               'ADJINC', # Inflation adjustment factor for income variables
               'TYPEHUGQ', # Type of household (Household or group quarters)
  
               #Demographic variables
               'AGEP', # Age of person
               "SEX", # Sex
               'NP', # Number of persons in a household
               'TEN', # Tenure
               'RAC1P', # Race
               'HISP', # Recoded detailed Hispanic origin (Ethnicity)
               'R18', #Presence of persons under 18 years in household
               'R60', # Presence of persons over 60 years in household
               'R65', # Presence of persons over 65 years in household
  
               # Income variables
               "FINCP", # Family Income
               "HINCP", # Household Income
               "INTP", # Interest, dividends, and net rental income
               "PINCP", # Total person's income
               "WAGP", # Wages or salary income past 12 months
               "SSIP", # Supplementary Security Income
               "SSP", # Social Security income
               "SEMP", # Self employment income
               "RETP", # Retirement income
               "PAP", # Public assistance income
               "OIP", #All other income
               
               # Overcrowding variables
               'BDSP', # Number of bedrooms
               'RMSP',
               'CPLT', # Couple Type
               'RELSHIPP', # Relationship to the householder
               'PSF', # Presence of subfamily
               'SFN', # Subfamily number
               'SFR', # Subfamily relationship
               'NR', # Presence of non-relative in household
               'NRC', # Number of related children in a household
               'MULTG', # Multigenerational household flag
               'HHT', # Household/family type
               'HHT2', # Household family type (including cohabiting)
               "PARTNER", # Unmarried partner household
               'NPP', # Grandparent headed household with no parent present
               'NPF', # Number of persons in family
               'HUGCL', # Household with grandparent living with grandchildren
               'NOC', # Number of own children
               'HUPAC', # Presence and age of children
               'HUPAOC', # Presence and age of own children
               'HUPARC', # Presence and age of related children
               
               # Disability variables
                    
            )

# Terminal year in the vintage
pums.vintage = 2023

# Survey from which the data is requested
survey = "acs5"
```
# 1.0 Load Data
# 1.1 Load PUMS Data from {tidycensus}
```{r}
# Load PUMA to RPA Crosswalk
# For this analysis we will group Martha's Vineyard Commission, Nantucket Planning and Economic Development Commission and Cape Cod Commission into one group -- "CCC" -- which will refer to the Cape and Islands.
puma.rpa_xwalk <- read.csv(here(paste("urbansim_model_update/inputs/puma2020_rpa_crosswalk.csv")))

# Check we have 11 RPAs int the crosswalk
# NPEDC and MVC are cannot be separated from CCC since they share PUMA 1301.
print(length(unique(puma.rpa_xwalk$rpa_acr)))

# Load PUMS data
# Vintage: 2019-2023 ACS 5-year PUMS
# Variables:
# - 
pums <- pums_query(var.list = pums.vars, yr = pums.vintage, srvy = survey) 
  # 
  # mutate(PUMA = as.character(str_pad(PUMA, width = 5, side = "left", pad = 0)))
```

# 2.0 Household Type Analysis
```{r}
```

# 3.0 Income Distribution Analysis
```{r}
```

# 4.0  Older Household Analysis
```{r}
```

# 5.0 Household Size Analysis
```{r}
```